<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>19.3. Creating a User Model &#8212; Java Web Development  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="19.4. Login and Registration Forms" href="login-registration-forms.html" />
    <link rel="prev" title="19.2. Hashing Passwords" href="hashing-passwords.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
        </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html"><span class="section-number">19. </span>Authentication</a></li>
    <li class="active"><span class="section-number">19.3. </span>Creating a <code class="docutils literal notranslate"><span class="pre">User</span></code> Model</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content " role="main">

    
  <div class="section" id="creating-a-user-model">
<span id="user-auth-walkthrough"></span><h1><span class="section-number">19.3. </span>Creating a <code class="docutils literal notranslate"><span class="pre">User</span></code> Model<a class="headerlink" href="#creating-a-user-model" title="Permalink to this headline">¶</a></h1>
<p>The next few sections walk through the steps necessary to enable simple authentication in the <code class="docutils literal notranslate"><span class="pre">coding-events</span></code> app. Along the way, we will use some advanced concepts that you haven’t fully learned. That’s okay. We don’t expect you to understand every detail the next few sections. However, you do need to understand the purpose of each step in enabling authentication.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>While we’ll use <code class="docutils literal notranslate"><span class="pre">coding-events</span></code>, these steps would be the same for any other app. If you want to add simple authentication to a Spring Boot application in the future, reference this chapter.</p>
</div>
<p>Before we can authenticate users, we need users to authenticate! We’ll start by adding a <code class="docutils literal notranslate"><span class="pre">User</span></code> model.</p>
<div class="section" id="a-user-model">
<h2><span class="section-number">19.3.1. </span>A <code class="docutils literal notranslate"><span class="pre">User</span></code> Model<a class="headerlink" href="#a-user-model" title="Permalink to this headline">¶</a></h2>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>You can use the <a class="reference external" href="https://github.com/LaunchCodeEducation/coding-events/tree/add-tags" target="_blank">add-tags branch<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> as your starting point for this section.</p>
</div>
<p>A model class representing users needs, at a minimum, fields representing username and password.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">models</span></code> package, create a <code class="docutils literal notranslate"><span class="pre">User</span></code> class with <code class="docutils literal notranslate"><span class="pre">&#64;Entity</span></code> and extending <code class="docutils literal notranslate"><span class="pre">AbstractEntity</span></code>. It should have two string fields, <code class="docutils literal notranslate"><span class="pre">username</span></code> and <code class="docutils literal notranslate"><span class="pre">pwHash</span></code>. We only need a getter for <code class="docutils literal notranslate"><span class="pre">username</span></code>.</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="kd">extends</span> <span class="n">AbstractEntity</span> <span class="p">{</span>

   <span class="nd">@NotNull</span>
   <span class="kd">private</span> <span class="n">String</span> <span class="n">username</span><span class="p">;</span>

   <span class="nd">@NotNull</span>
   <span class="kd">private</span> <span class="n">String</span> <span class="n">pwHash</span><span class="p">;</span>

   <span class="kd">public</span> <span class="nf">User</span><span class="p">()</span> <span class="p">{}</span>

   <span class="kd">public</span> <span class="nf">User</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="na">pwHash</span> <span class="o">=</span> <span class="n">password</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="kd">public</span> <span class="n">String</span> <span class="nf">getUsername</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">username</span><span class="p">;</span>
   <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Notice that the constructor takes a parameter named <code class="docutils literal notranslate"><span class="pre">password</span></code> and uses it to set the value of <code class="docutils literal notranslate"><span class="pre">pwHash</span></code>. We mentioned <a class="reference internal" href="hashing-passwords.html#hashing-passwords"><span class="std std-ref">previously</span></a> that we should never store passwords, so in a moment, we will update line 26 by creating a hash from the given password to store.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>Our validation annotations on <code class="docutils literal notranslate"><span class="pre">User</span></code> are very lenient. This is okay, however, because we will validate user input used to make <code class="docutils literal notranslate"><span class="pre">User</span></code> objects using a DTO with more restrictive validation.</p>
</div>
</div>
<div class="section" id="hashing-passwords">
<h2><span class="section-number">19.3.2. </span>Hashing Passwords<a class="headerlink" href="#hashing-passwords" title="Permalink to this headline">¶</a></h2>
<p id="index-0">We’ll use the bycrypt hash algorithm. One way to access this algorithm is via the following dependency:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>org.springframework.security:spring-security-crypto
</pre></div>
</div>
<p>Add this as an <code class="docutils literal notranslate"><span class="pre">implementation</span></code> dependency in your <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file.</p>
<p>This dependency provides the <code class="docutils literal notranslate"><span class="pre">BCryptPasswordEncoder</span></code> class, which we will use to create and verify hashes. While our class needs one of these encoder objects, it does not need to be an instance variable. We’ll make it static so it can be shared by all <code class="docutils literal notranslate"><span class="pre">User</span></code> objects.</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">BCryptPasswordEncoder</span> <span class="n">encoder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BCryptPasswordEncoder</span><span class="p">();</span>
</pre></div>
</td></tr></table></div>
<p>In the constructor, we can use <code class="docutils literal notranslate"><span class="pre">encoder</span></code> to create a hash from the given password:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="nf">User</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">,</span> <span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">this</span><span class="p">.</span><span class="na">username</span> <span class="o">=</span> <span class="n">username</span><span class="p">;</span>
   <span class="k">this</span><span class="p">.</span><span class="na">pwHash</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Our <code class="docutils literal notranslate"><span class="pre">User</span></code> objects should also be responsible for determining if a given password is a match for the hash stored by the object. We can do this using the <code class="docutils literal notranslate"><span class="pre">encoder.matches()</span></code> method. Let’s put this behavior in a method at the bottom of our <code class="docutils literal notranslate"><span class="pre">User</span></code> class:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMatchingPassword</span><span class="p">(</span><span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">encoder</span><span class="p">.</span><span class="na">matches</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">pwHash</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition-warning admonition">
<p class="admonition-title"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i>Warning</p>
<p>Notice that we are using <code class="docutils literal notranslate"><span class="pre">encoder.matches()</span></code> rather than directly comparing hash values. More explicitly, the following comparison will NOT work to compare hashes generated by bcrypt:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isMatchingPassword</span><span class="p">(</span><span class="n">String</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">String</span> <span class="n">candidateHash</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">.</span><span class="na">encode</span><span class="p">(</span><span class="n">password</span><span class="p">);</span>
   <span class="k">return</span> <span class="n">candidateHash</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">pwHash</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While our conceptual example in the previous section used direct comparison of hashes—and some hashing techniques allow you to do so—bcrypt does not. This is because bcrypt internally uses a technique called <a class="reference external" href="https://en.wikipedia.org/wiki/Salt_(cryptography)" target="_blank">salting<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>, which requires additional steps before comparison. These additional steps are carried out by <code class="docutils literal notranslate"><span class="pre">encoder.matches()</span></code>.</p>
</div>
</div>
<div class="section" id="creating-the-userrepository">
<h2><span class="section-number">19.3.3. </span>Creating the <code class="docutils literal notranslate"><span class="pre">UserRepository</span></code><a class="headerlink" href="#creating-the-userrepository" title="Permalink to this headline">¶</a></h2>
<p>As usual, we need a repository in order to access <code class="docutils literal notranslate"><span class="pre">User</span></code> objects stored in the database. This time, however, we add a twist. Create <code class="docutils literal notranslate"><span class="pre">UserRepository</span></code> in the <code class="docutils literal notranslate"><span class="pre">data</span></code> package, with the following contents:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="p">{</span>

   <span class="n">User</span> <span class="nf">findByUsername</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p id="index-1">While our repository extends <code class="docutils literal notranslate"><span class="pre">CrudRepository</span></code>, it also contains a new method, <code class="docutils literal notranslate"><span class="pre">findByUsername</span></code>. Based on the method signature, it appears that this method is intended to take a username, and return the given user with that username. Indeed, when our application runs, the <code class="docutils literal notranslate"><span class="pre">UserRepository</span></code> will have such a method.</p>
<p>Spring allows for additional, custom methods to be added to repository interfaces, as long as they follow some basic naming conventions. These conventions are straightforward to use, and allow you to create additional, more sophisticated query methods. Methods created in this way are called <strong>query methods</strong>, and their rules are defined in <a class="reference external" href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation" target="_blank">Spring’s documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.</p>
<div class="admonition-note admonition">
<p class="admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p>The final code for this section is available in the
<a class="reference external" href="https://github.com/LaunchCodeEducation/coding-events/tree/user-model" target="_blank">user-model branch<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
of the <code class="docutils literal notranslate"><span class="pre">coding-events-demo</span></code> repository.</p>
</div>
</div>
<div class="section" id="check-your-understanding">
<h2><span class="section-number">19.3.4. </span>Check Your Understanding<a class="headerlink" href="#check-your-understanding" title="Permalink to this headline">¶</a></h2>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p>Why can we not use Java string comparison when evaluating values generated with bcrypt?</p>
<ol class="arabic simple">
<li><p>bcrypt will never create two matching hashes.</p></li>
<li><p>Java does not have a native string comparator method.</p></li>
<li><p>Salting adds variance to hashes generated from the same plain text.</p></li>
<li><p>Answers a and c.</p></li>
</ol>
</div>
<div class="admonition-question admonition">
<p class="admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserRepository</span> <span class="kd">extends</span> <span class="n">CrudRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="p">{</span>

   <span class="n">User</span> <span class="nf">findByUsername</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>True/False: From the code block above, line 11 is missing a return statement.</p>
<ol class="arabic simple">
<li><p>True</p></li>
<li><p>False</p></li>
</ol>
</div>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="hashing-passwords.html"><span aria-hidden="true">&larr;</span> <span class="section-number">19.2. </span>Hashing Passwords</a></li>
        
        
        <li class="next"><a href="login-registration-forms.html"><span class="section-number">19.4. </span>Login and Registration Forms <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/auth/user-model.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>